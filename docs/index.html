<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>lonnymq</title><meta name="description" content="Documentation for lonnymq"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">lonnymq</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>lonnymq</h1></div><div class="tsd-panel tsd-typography"><h1 id="lonnymq" class="tsd-anchor-link">LonnyMQ<a href="#lonnymq" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>A high-performance, multi-tenant PostgreSQL message queue implementation for Node.js/TypeScript. Docs can be found <a href="https://tlonny.github.io/lonnymq">here</a></p>
<h2 id="features" class="tsd-anchor-link">Features<a href="#features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>High throughput message processing</li>
<li>Multi-tenant concurrency and rate limits</li>
<li>Durable message processing</li>
<li>Support for retries, recovery and custom back-off strategies</li>
<li>Message prioritisation</li>
<li>Queue operations as part of <em>existing</em> database transactions</li>
<li>Database client agnostic with optional adapters</li>
<li>Granular events via PostgreSQL <code>NOTIFY</code> (Avoid relying on polling to fetch new messages)</li>
<li>Zero dependencies</li>
</ul>
<p><strong>Note:</strong> Unlike other queue implementations, LonnyMQ provides direct access to queue methods rather than providing batteries-included Worker/Processor daemons.</p>
<h3 id="benchmarking" class="tsd-anchor-link">Benchmarking<a href="#benchmarking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>With the following parameters:</p>
<ul>
<li>Everything running in a single Bun instance</li>
<li>A locally hosted postgres database</li>
<li>The code as-is below in &quot;Quick Look&quot;, but with 8 producers and 8 consumers</li>
</ul>
<p>A message throughput of <strong>~1,800</strong> messages per second is observed.</p>
<h2 id="quick-look" class="tsd-anchor-link">Quick Look<a href="#quick-look" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Queue</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;lonnymq&quot;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Pool</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;pg&quot;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">databaseClient</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Pool</span><span class="hl-1">({ </span><span class="hl-2">connectionString:</span><span class="hl-1"> </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">env</span><span class="hl-1">.</span><span class="hl-5">DATABASE_URL</span><span class="hl-1"> })</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">queue</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Queue</span><span class="hl-1">({ </span><span class="hl-2">schema:</span><span class="hl-1"> </span><span class="hl-3">&quot;lonny&quot;</span><span class="hl-1"> })</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">content</span><span class="hl-1"> = </span><span class="hl-2">Buffer</span><span class="hl-1">.</span><span class="hl-6">from</span><span class="hl-1">(</span><span class="hl-3">&quot;hello world&quot;</span><span class="hl-1">)</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">produce</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">while</span><span class="hl-1"> (</span><span class="hl-4">true</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">create</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-2">databaseClient:</span><span class="hl-1"> </span><span class="hl-2">pool</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-2">content</span><br/><span class="hl-1">        })</span><br/><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">resultType</span><span class="hl-1"> !== </span><span class="hl-3">&quot;MESSAGE_CREATED&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">continue</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">channelSize</span><span class="hl-1"> &gt; </span><span class="hl-7">1_000</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">sleep</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">channelSize</span><span class="hl-1">)</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">consume</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">while</span><span class="hl-1"> (</span><span class="hl-4">true</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-6">dequeue</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-2">databaseClient:</span><span class="hl-1"> </span><span class="hl-2">pool</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">lockMs:</span><span class="hl-1"> </span><span class="hl-7">1_000</span><br/><span class="hl-1">        })</span><br/><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">resultType</span><span class="hl-1"> === </span><span class="hl-3">&quot;MESSAGE_DEQUEUED&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">({ </span><span class="hl-2">databaseClient:</span><span class="hl-1"> </span><span class="hl-2">pool</span><span class="hl-1"> })</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">// Kick off producer loop</span><br/><span class="hl-6">produce</span><span class="hl-1">()</span><br/><br/><span class="hl-8">// Kick off consumer loop</span><br/><span class="hl-6">consume</span><span class="hl-1">()</span>
</code><button type="button">Copy</button></pre>

<h2 id="setup--installation" class="tsd-anchor-link">Setup &amp; Installation<a href="#setup--installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>LonnyMQ can be installed from npm:</p>
<pre><code class="bash"><span class="hl-6">npm</span><span class="hl-1"> </span><span class="hl-3">install</span><span class="hl-1"> </span><span class="hl-3">lonnymq</span>
</code><button type="button">Copy</button></pre>

<p>Once the package is installed, the queue needs to be &quot;installed&quot; to a postgres schema. The requisite SQL for this can be generated via:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sqlCommands</span><span class="hl-1"> = </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-6">install</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">eventChannel:</span><span class="hl-1"> </span><span class="hl-3">&quot;lonnymq-events&quot;</span><span class="hl-1">,</span><br/><br/><span class="hl-6">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-2">sql</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-2">sqlCommands</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">pool</span><br/><span class="hl-1">}</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<p><em>Optional</em> parameters can be passed in to alter default queue behaviour/semantics. If an <code>eventChannel</code> is provided, LonnyMQ will publish queue events to the channel provided via <code>NOTIFY</code>.</p>
<h2 id="channels" class="tsd-anchor-link">Channels<a href="#channels" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Channels provide LonnyMQ's multi-tenancy support. They can be considered lightweight sub-queues that are read from in round-robin fashion. There is no performance penalty for using large numbers of channels, so they can be assigned on a highly granular basis (e.g., per-user) to ensure work is scheduled fairly.</p>
<p>Channels can be configured with rate limiting, concurrency and capacity constraints by setting their <em>channel policy</em>:</p>
<pre><code class="typescript"><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><br/><span class="hl-1">    .</span><span class="hl-6">channel</span><span class="hl-1">(</span><span class="hl-3">&quot;my-channel&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-2">policy</span><br/><span class="hl-1">    .</span><span class="hl-6">set</span><span class="hl-1">({ </span><br/><span class="hl-1">        </span><span class="hl-2">databaseClient</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">maxConcurrency:</span><span class="hl-1"> </span><span class="hl-7">1</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">releaseIntervalMs:</span><span class="hl-1"> </span><span class="hl-7">1000</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">maxSize:</span><span class="hl-1"> </span><span class="hl-7">1_000</span><br/><span class="hl-1">    })</span><br/><br/><span class="hl-8">// Remove all constraints:</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><br/><span class="hl-1">    .</span><span class="hl-6">channel</span><span class="hl-1">(</span><span class="hl-3">&quot;my-channel&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-2">policy</span><br/><span class="hl-1">    .</span><span class="hl-6">clear</span><span class="hl-1">({ </span><span class="hl-2">databaseClient</span><span class="hl-1"> })</span>
</code><button type="button">Copy</button></pre>

<h2 id="message-creation" class="tsd-anchor-link">Message Creation<a href="#message-creation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can add a message to the queue using the <code>create</code> function. By default, messages are assigned to a unique channel, resulting in basic FIFO behaviour.</p>
<pre><code class="typescript"><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">create</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">databaseClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-2">Buffer</span><span class="hl-1">.</span><span class="hl-6">from</span><span class="hl-1">(</span><span class="hl-3">&quot;Hello, world&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<p>If you need to assign messages to specific channels (for example, to take advantage of fairness, concurrency or rate limiting features), you can specify the channel explicitly:</p>
<pre><code class="typescript"><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><br/><span class="hl-1">    .</span><span class="hl-6">channel</span><span class="hl-1">(</span><span class="hl-3">&quot;my-channel&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-2">message</span><br/><span class="hl-1">    .</span><span class="hl-6">create</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">databaseClient</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-2">Buffer</span><span class="hl-1">.</span><span class="hl-6">from</span><span class="hl-1">(</span><span class="hl-3">&quot;Hello, world&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    })</span>
</code><button type="button">Copy</button></pre>

<p>By default, created messages are immediately available for processing. To delay availability you can pass a <code>dequeueAt</code> unix timestamp (in milliseconds) that specifies the earliest time the message may be dequeued.</p>
<pre><code class="typescript"><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">create</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">databaseClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">content:</span><span class="hl-1"> </span><span class="hl-2">Buffer</span><span class="hl-1">.</span><span class="hl-6">from</span><span class="hl-1">(</span><span class="hl-3">&quot;Hello, world&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-2">dequeueAt:</span><span class="hl-1"> </span><span class="hl-2">Date</span><span class="hl-1">.</span><span class="hl-6">now</span><span class="hl-1">() + </span><span class="hl-7">5_000</span><span class="hl-1"> </span><span class="hl-8">// 5s in the future</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<p>N.B. <code>dequeueAt</code> is compared against the <em>database</em> clock.</p>
<h3 id="message-prioritization" class="tsd-anchor-link">Message Prioritization<a href="#message-prioritization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>LonnyMQ doesn't use an explicit message priority field for performance reasons. In short, there is no way to find the highest priority message that is also available for dequeue for a particular channel without some degree of linear scanning in the worst case vs. simply using a logarithmic index lookup.</p>
<p>However, messages that <em>are</em> available for processing are dequeued from their channels in order of their <code>dequeueAt</code> values (oldest first). Thus, by overloading the semantics of the <code>dequeueAt</code> field and using <em>historic</em> unix timestamps (i.e. <code>0</code>, <code>1</code>, <code>2</code>, etc.) - messages can trivially be prioritized within a channel.</p>
<p>N.B. there is no way to <em>globally</em> prioritize a message - channels will <em>always</em> be accessed in a round-robin fashion.</p>
<h2 id="message-processing" class="tsd-anchor-link">Message Processing<a href="#message-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Messages can be fetched for processing by calling <code>dequeue</code> on the <code>Queue</code> - this locks the message for a specified duration. Once processing is complete, messages must be &quot;finalized&quot; via <strong>deletion</strong> or <strong>deferral</strong> (for further processing in the future).</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dequeueResult</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-6">dequeue</span><span class="hl-1">({ </span><br/><span class="hl-1">    </span><span class="hl-2">databaseClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">lockMs:</span><span class="hl-1"> </span><span class="hl-7">60_000</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">dequeueResult</span><span class="hl-1">.</span><span class="hl-2">resultType</span><span class="hl-1"> === </span><span class="hl-3">&quot;MESSAGE_DEQUEUED&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">message</span><span class="hl-1"> } = </span><span class="hl-2">dequeueResult</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Processing message: </span><span class="hl-4">${</span><span class="hl-2">message</span><span class="hl-9">.</span><span class="hl-2">id</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Content: </span><span class="hl-4">${</span><span class="hl-2">message</span><span class="hl-9">.</span><span class="hl-2">content</span><span class="hl-9">.</span><span class="hl-6">toString</span><span class="hl-9">()</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`State: </span><span class="hl-4">${</span><span class="hl-2">message</span><span class="hl-9">.</span><span class="hl-2">state</span><span class="hl-9">?.</span><span class="hl-6">toString</span><span class="hl-9">()</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-8">// Process the message...</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">processMessage</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-2">content</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-8">// Delete on success</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">({ </span><span class="hl-2">databaseClient</span><span class="hl-1"> })</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-2">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-2">numAttempts</span><span class="hl-1"> &gt;= </span><span class="hl-7">5</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-8">// Too many retries, delete permanently</span><br/><span class="hl-1">            </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">({ </span><span class="hl-2">databaseClient</span><span class="hl-1"> })</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-8">// Defer for retry with exponential backoff and updated state</span><br/><span class="hl-1">            </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">backoffMs</span><span class="hl-1"> = </span><span class="hl-2">Math</span><span class="hl-1">.</span><span class="hl-6">pow</span><span class="hl-1">(</span><span class="hl-7">2</span><span class="hl-1">, </span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-2">numAttempts</span><span class="hl-1">) * </span><span class="hl-7">1_000</span><br/><span class="hl-1">            </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">defer</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-2">databaseClient</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">dequeueAt:</span><span class="hl-1"> </span><span class="hl-2">Date</span><span class="hl-1">.</span><span class="hl-6">now</span><span class="hl-1">() + </span><span class="hl-2">backoffMs</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">state:</span><span class="hl-1"> </span><span class="hl-2">Buffer</span><span class="hl-1">.</span><span class="hl-6">from</span><span class="hl-1">(</span><span class="hl-5">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">({ </span><br/><span class="hl-1">                    </span><span class="hl-2">error:</span><span class="hl-1"> </span><span class="hl-2">error</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-2">lastAttempt:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Date</span><span class="hl-1">().</span><span class="hl-6">toISOString</span><span class="hl-1">()</span><br/><span class="hl-1">                }))</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">} </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;No messages available&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The <code>lockMs</code> parameter on <code>dequeue()</code> specifies how long a message will remain exclusively locked after being dequeued. While locked, the message is <strong>not available</strong> for subsequent <code>dequeue()</code> calls, preventing duplicate processing. If your process crashes or takes longer than expected, the message will automatically become available for dequeue again after the lock expires.</p>
<p>When a message is deferred it becomes immediately available for re-processing unless you supply a <code>dequeueAt</code> timestamp.</p>
<p><strong>Note:</strong> The above shows just one processing pattern (defer on failure with retry limits). You have complete flexibility in how you handle message processing - you might delete messages immediately, defer them unconditionally, implement different retry strategies based on error types, or use the message metadata (attempts, state, channel) to make sophisticated routing decisions.</p>
<h3 id="extending-message-locks-with-heartbeats" class="tsd-anchor-link">Extending Message Locks with Heartbeats<a href="#extending-message-locks-with-heartbeats" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For messages that take a long time to process, setting a large initial lock is far from ideal. A crash shortly after message dequeue will result in channel throughput being degraded for a significant time (if the channel is concurrency-constrained). To mitigate this, you can set a short initial lock time that can be periodically renewed during message processing via a heartbeat:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dequeueResult</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-6">dequeue</span><span class="hl-1">({ </span><br/><span class="hl-1">    </span><span class="hl-2">databaseClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">lockMs:</span><span class="hl-1"> </span><span class="hl-7">30_000</span><span class="hl-1"> </span><br/><span class="hl-1">})</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">dequeueResult</span><span class="hl-1">.</span><span class="hl-2">resultType</span><span class="hl-1"> === </span><span class="hl-3">&quot;MESSAGE_DEQUEUED&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">message</span><span class="hl-1"> } = </span><span class="hl-2">dequeueResult</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">// Start long-running process</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">longTask</span><span class="hl-1"> = </span><span class="hl-6">processLongRunningTask</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-2">content</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">// Set up heartbeat to extend lock every 20 seconds</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">heartbeatInterval</span><span class="hl-1"> = </span><span class="hl-6">setInterval</span><span class="hl-1">(</span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">heartbeat</span><span class="hl-1">({ </span><br/><span class="hl-1">            </span><span class="hl-2">databaseClient</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">lockMs:</span><span class="hl-1"> </span><span class="hl-7">30_000</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">    }, </span><span class="hl-7">20_000</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">longTask</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">({ </span><span class="hl-2">databaseClient</span><span class="hl-1"> })</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-2">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">defer</span><span class="hl-1">({ </span><br/><span class="hl-1">            </span><span class="hl-2">databaseClient</span><span class="hl-1">, </span><br/><span class="hl-1">            </span><span class="hl-2">dequeueAt:</span><span class="hl-1"> </span><span class="hl-2">Date</span><span class="hl-1">.</span><span class="hl-6">now</span><span class="hl-1">() + </span><span class="hl-7">60_000</span><span class="hl-1"> </span><br/><span class="hl-1">        })</span><br/><span class="hl-1">    } </span><span class="hl-0">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">clearInterval</span><span class="hl-1">(</span><span class="hl-2">heartbeatInterval</span><span class="hl-1">)</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="graceful-shutdowns-and-message-recovery" class="tsd-anchor-link">Graceful Shutdowns and Message Recovery<a href="#graceful-shutdowns-and-message-recovery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If your program ends unexpectedly, messages that are currently being processed may become &quot;orphaned&quot; in a locked state - causing channel blockages and reducing throughput until locks expire. To mitigate this problem, it's essential that you shut down gracefully by catching unhandled exceptions and signals (i.e., <code>SIGINT</code>/<code>SIGTERM</code>) and finalize all outstanding messages before exiting.</p>
<h2 id="events" class="tsd-anchor-link">Events<a href="#events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Using PostgreSQL <code>NOTIFY</code>, we can receive a granular stream of queue events:</p>
<ol>
<li><code>MESSAGE_CREATED</code></li>
<li><code>MESSAGE_DEFERRED</code></li>
<li><code>MESSAGE_DELETED</code></li>
</ol>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">install</span><span class="hl-1"> = </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-6">install</span><span class="hl-1">({ </span><span class="hl-2">eventChannel:</span><span class="hl-1"> </span><span class="hl-3">&quot;EVENTS&quot;</span><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<h3 id="improving-on-polling" class="tsd-anchor-link">Improving on Polling<a href="#improving-on-polling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The simplest approach for processing messages is to call <code>dequeue</code> in a loop, backing off with a sleep when no messages are available. The downside of this approach is that we lose reactivity as we increase the polling timeout interval.</p>
<pre><code class="typescript"><span class="hl-8">// Basic polling approach</span><br/><span class="hl-0">while</span><span class="hl-1"> (</span><span class="hl-4">true</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-6">dequeue</span><span class="hl-1">({ </span><span class="hl-2">databaseClient</span><span class="hl-1">, </span><span class="hl-2">lockMs:</span><span class="hl-1"> </span><span class="hl-7">30_000</span><span class="hl-1"> })</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">resultType</span><span class="hl-1"> === </span><span class="hl-3">&quot;MESSAGE_NOT_AVAILABLE&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">sleep</span><span class="hl-1">(</span><span class="hl-7">5_000</span><span class="hl-1">) </span><br/><span class="hl-1">        </span><span class="hl-0">continue</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-8">// Process message...</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">processMessage</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">({ </span><span class="hl-2">databaseClient</span><span class="hl-1"> })</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>To improve reactivity, you can use the events system to track when new messages become available. By listening for <code>MESSAGE_CREATED</code> and <code>MESSAGE_DEFERRED</code> events and tracking their <code>dequeueAt</code> values, you can determine the optimal time to retry dequeuing:</p>
<pre><code class="typescript"><span class="hl-8">// LISTEN/NOTIFY only works with a single connection - not on a connection pool.</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">databaseClient</span><span class="hl-1">.</span><span class="hl-6">connect</span><span class="hl-1">()</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">(</span><span class="hl-3">`LISTEN &quot;EVENTS&quot;`</span><span class="hl-1">)</span><br/><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-2">nextWakeTime</span><span class="hl-1"> = </span><span class="hl-2">Date</span><span class="hl-1">.</span><span class="hl-6">now</span><span class="hl-1">()</span><br/><br/><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-3">&quot;notification&quot;</span><span class="hl-1">, (</span><span class="hl-2">msg</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">msg</span><span class="hl-1">.</span><span class="hl-2">channel</span><span class="hl-1"> === </span><span class="hl-3">&quot;EVENTS&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">event</span><span class="hl-1"> = </span><span class="hl-2">Queue</span><span class="hl-1">.</span><span class="hl-6">decode</span><span class="hl-1">(</span><span class="hl-2">msg</span><span class="hl-1">.</span><span class="hl-2">payload</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">eventType</span><span class="hl-1"> === </span><span class="hl-3">&quot;MESSAGE_CREATED&quot;</span><span class="hl-1"> || </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">eventType</span><span class="hl-1"> === </span><span class="hl-3">&quot;MESSAGE_DEFERRED&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-2">nextWakeTime</span><span class="hl-1"> = </span><span class="hl-2">Math</span><span class="hl-1">.</span><span class="hl-6">min</span><span class="hl-1">(</span><span class="hl-2">nextWakeTime</span><span class="hl-1">, </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">dequeueAt</span><span class="hl-1">)</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<h3 id="waiting-for-job-completion" class="tsd-anchor-link">Waiting for Job Completion<a href="#waiting-for-job-completion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>MESSAGE_DELETED</code> event can be used to create coordination patterns where one part of your application waits for an unrelated job to complete. By listening for deletion events on specific message IDs, you can implement blocking operations that wait for background work to finish.</p>
<h2 id="deadlocks" class="tsd-anchor-link">Deadlocks<a href="#deadlocks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>If all queue actions are isolated to their own transaction, there is zero risk of deadlocks occurring. That being said, it is <em>possible</em> to safely bulk-perform the following actions within a single transaction if we ensure they are performed in a consistent ordering with respect to the target channel:</p>
<ul>
<li>Message create</li>
<li>Channel policy set</li>
<li>Channel policy clear</li>
</ul>
<p>Beyond the actions specified above, it is <strong>unsafe</strong> to bulk-perform any of the remaining actions within a single transaction. Each of these actions should be isolated within their <strong>own</strong> transaction:</p>
<ul>
<li>Message dequeue</li>
<li>Message defer</li>
<li>Message delete</li>
<li>Message heartbeat</li>
</ul>
<h2 id="database-clients" class="tsd-anchor-link">Database Clients<a href="#database-clients" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>LonnyMQ is designed to be database client agnostic, requiring only a minimal interface that most PostgreSQL clients already implement. Your database client must provide a single <code>query</code> method with this signature:</p>
<pre><code class="typescript"><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-10">DatabaseClient</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">query</span><span class="hl-1">(</span><span class="hl-2">sql</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-2">params</span><span class="hl-1">: </span><span class="hl-10">Array</span><span class="hl-1">&lt;</span><span class="hl-10">unknown</span><span class="hl-1">&gt;): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">        </span><span class="hl-2">rows</span><span class="hl-1">: </span><span class="hl-10">Array</span><span class="hl-1">&lt;</span><span class="hl-10">Record</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-10">unknown</span><span class="hl-1">&gt;&gt;</span><br/><span class="hl-1">    }&gt;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="database-client-adapters" class="tsd-anchor-link">Database Client Adapters<a href="#database-client-adapters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For database clients that don't match the expected interface exactly, LonnyMQ provides an adapter system to improve the developer experience. You can provide an adapter function when creating a Queue:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Queue</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;lonnymq&quot;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">queue</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Queue</span><span class="hl-1">&lt;</span><span class="hl-10">NonCompliantDatabaseClient</span><span class="hl-1">&gt;({ </span><br/><span class="hl-1">    </span><span class="hl-2">schema:</span><span class="hl-1"> </span><span class="hl-3">&quot;lonny&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">adaptor</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">client</span><span class="hl-1"> : </span><span class="hl-10">NonCompliantDatabaseClient</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">        </span><span class="hl-6">query</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">sql</span><span class="hl-1">, </span><span class="hl-2">params</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-8">// Adapt the client&#39;s interface to match DatabaseClient</span><br/><span class="hl-1">            </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-6">executeQuery</span><span class="hl-1">(</span><span class="hl-2">sql</span><span class="hl-1">, </span><span class="hl-2">params</span><span class="hl-1">)</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> { </span><span class="hl-2">rows:</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">data</span><span class="hl-1"> }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#lonnymq"><span>Lonny<wbr/>MQ</span></a><ul><li><a href="#features"><span>Features</span></a></li><li><ul><li><a href="#benchmarking"><span>Benchmarking</span></a></li></ul></li><li><a href="#quick-look"><span>Quick <wbr/>Look</span></a></li><li><a href="#setup--installation"><span>Setup &amp; <wbr/>Installation</span></a></li><li><a href="#channels"><span>Channels</span></a></li><li><a href="#message-creation"><span>Message <wbr/>Creation</span></a></li><li><ul><li><a href="#message-prioritization"><span>Message <wbr/>Prioritization</span></a></li></ul></li><li><a href="#message-processing"><span>Message <wbr/>Processing</span></a></li><li><ul><li><a href="#extending-message-locks-with-heartbeats"><span>Extending <wbr/>Message <wbr/>Locks with <wbr/>Heartbeats</span></a></li><li><a href="#graceful-shutdowns-and-message-recovery"><span>Graceful <wbr/>Shutdowns and <wbr/>Message <wbr/>Recovery</span></a></li></ul></li><li><a href="#events"><span>Events</span></a></li><li><ul><li><a href="#improving-on-polling"><span>Improving on <wbr/>Polling</span></a></li><li><a href="#waiting-for-job-completion"><span>Waiting for <wbr/>Job <wbr/>Completion</span></a></li></ul></li><li><a href="#deadlocks"><span>Deadlocks</span></a></li><li><a href="#database-clients"><span>Database <wbr/>Clients</span></a></li><li><ul><li><a href="#database-client-adapters"><span>Database <wbr/>Client <wbr/>Adapters</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">lonnymq</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
